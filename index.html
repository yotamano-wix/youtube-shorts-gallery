<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Infinite Scrolling Carousel</title>
  <style>
    /* Full Width and 800px Fixed Height */
    .carousel-container {
      display: flex;
      overflow: hidden;
      width: 100%;
      height: 800px;
      position: relative;
    }

    /* Wrapper for videos */
    .carousel-wrapper {
      display: flex;
      /* No transition here as we reset position instantaneously */
    }

    /* Each video container */
    .video-container {
      position: relative;
      width: calc((9 / 16) * 800px); /* Dynamic width based on 9:16 aspect ratio */
      height: 800px;
      margin-right: 4px; /* 4px margin between videos */
      flex-shrink: 0;
    }
  </style>
</head>
<body>
  <div class="carousel-container">
    <div class="carousel-wrapper" id="videoGallery"></div>
  </div>

  <!-- Load YouTube Iframe API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    const players = [];
    let activePlayer = null; // Track the currently active (hovered) player
    let scrollSpeed = 1; // Pixels per tick
    let currentScroll = 0; // Track current scroll position
    let scrollInterval;

    function getVideoParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const videos = [];
      for (const [key, value] of urlParams.entries()) {
        if (key.startsWith('video')) {
          videos.push(value);
        }
      }
      return videos;
    }

    function onYouTubeIframeAPIReady() {
      loadVideosFromParams();
    }

    function loadVideosFromParams() {
      const videos = getVideoParams();
      const gallery = document.getElementById('videoGallery');

      gallery.innerHTML = ''; // Clear any existing content

      // Append original set of videos
      videos.forEach((videoId, index) => {
        addVideoToGallery(gallery, videoId, index);
      });

      // Append duplicate set of videos for seamless looping
      videos.forEach((videoId, index) => {
        addVideoToGallery(gallery, videoId, index + videos.length);
      });

      // Start the smooth scrolling loop
      startScrolling(gallery, videos.length);
    }

    // Helper function to add video iframe
    function addVideoToGallery(gallery, videoId, index) {
      const videoContainer = document.createElement('div');
      videoContainer.classList.add('video-container');
      
      const iframe = document.createElement('iframe');
      iframe.setAttribute('id', `player-${index}`);
      iframe.src = `https://www.youtube.com/embed/${videoId}?enablejsapi=1&autoplay=1&mute=1&loop=1&playlist=${videoId}&controls=0&showinfo=0&modestbranding=1`;
      iframe.allow = "autoplay";
      iframe.width = '100%';
      iframe.height = '100%';
      iframe.style.border = 'none';

      videoContainer.appendChild(iframe);
      gallery.appendChild(videoContainer);

      const player = new YT.Player(iframe, {
        events: {
          'onReady': function (event) {
            event.target.mute(); // Start muted
          }
        }
      });

      players.push(player);

      videoContainer.addEventListener("mouseover", () => handleMouseOver(player));
      videoContainer.addEventListener("mouseleave", handleMouseLeave);
    }

    function handleMouseOver(player) {
      if (activePlayer && activePlayer !== player) {
        activePlayer.mute(); // Mute the previously active player
      }
      player.unMute();
      activePlayer = player; // Set this player as the currently active one
    }

    function handleMouseLeave() {
      if (activePlayer) {
        activePlayer.mute();
      }
    }

    function startScrolling(gallery, videoCount) {
      const videoWidth = gallery.firstChild.offsetWidth + 4; // Width of one video + margin
      const totalScrollWidth = videoWidth * videoCount; // Width of the original set

      scrollInterval = setInterval(() => {
        currentScroll += scrollSpeed;
        gallery.style.transform = `translateX(-${currentScroll}px)`;

        // Reset scroll position for seamless looping
        if (currentScroll >= totalScrollWidth) {
          currentScroll = 0;
          gallery.style.transform = `translateX(0)`;
        }
      }, 20); // Adjust the interval for smoother effect
    }

    // Stop scrolling when the page is not in focus
    window.addEventListener('blur', () => clearInterval(scrollInterval));
    window.addEventListener('focus', () => {
      const gallery = document.getElementById('videoGallery');
      startScrolling(gallery, getVideoParams().length);
    });
  </script>
</body>
</html>
