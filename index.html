<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scrollable and Animated Carousel</title>
  <style>
    /* Remove default body margin */
    body {
      margin: 0;
    }


    /* Wrapper for videos with automatic scrolling animation */
    .carousel-wrapper {
      display: flex;
      animation: scroll 20s linear infinite; /* Automatic scroll animation */
    }


.carousel-container {
  display: flex;
  overflow-x: auto;
  overflow-y: hidden;
  width: 100%;
  height: 100%; /* Fills the height of the iframe */
  position: relative;
  scroll-behavior: smooth;
}

.video-container {
  position: relative;
  width: calc((9 / 16) * 100%); /* Dynamic width based on 9:16 aspect ratio */
  height: 100%; /* Full height of the container */
  margin-right: 4px;
  box-sizing: border-box;
  padding: 0;
  flex-shrink: 0;
}

iframe {
  width: 100%;
  height: 100%; /* Fills the height of each video container */
  border: none;
  padding: 0;
  overflow: hidden;
}

    /* Keyframes for infinite scroll animation */
    @keyframes scroll {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(-50%); /* Adjust based on content width */
      }
    }

    /* Pause animation on hover for better UX */
    .carousel-container:hover .carousel-wrapper {
      animation-play-state: paused;
    }
  </style>
</head>
<body>
  <div class="carousel-container" id="carouselContainer">
    <div class="carousel-wrapper" id="videoGallery"></div>
  </div>

  <!-- Load YouTube Iframe API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    const players = [];
    let activePlayer = null; // Track the currently active (hovered) player

    // Fallback video IDs to use if no parameters are present
    const fallbackVideos = ["3pD6Q8Xfl9E", "Y-blA4mAvoM", "3pauPo1DS4U", "6C8QHmx8xDA", "kURjkzmRQJQ"];

    // Function to check URL parameters or use fallback videos
    function getVideoParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const videos = [];

      // Check each video parameter in the URL
      for (let i = 0; urlParams.has(`video${i}`); i++) {
        const videoId = urlParams.get(`video${i}`);
        if (videoId && videoId !== "undefined") {
          videos.push(videoId);
        }
      }

      // If no video parameters are found, use the fallback array
      return videos.length > 0 ? videos : fallbackVideos;
    }

    // Function to wait for the YouTube Iframe API to load
    function loadYouTubeIframeAPI() {
      return new Promise(resolve => {
        if (window.YT && window.YT.Player) {
          resolve();
        } else {
          window.onYouTubeIframeAPIReady = resolve;
        }
      });
    }

    // Initialize the carousel after ensuring API and videos are fully loaded
    async function initializeCarousel() {
      await loadYouTubeIframeAPI();
      const videos = getVideoParams();

      // Ensure videos are loaded in gallery
      const loaded = await loadVideosIntoGallery(videos);
      if (loaded) {
        setCarouselAnimationSpeed();
      } else {
        console.error("Videos failed to load.");
      }
    }

    // Load videos into gallery and wait for all iframes to be ready
    async function loadVideosIntoGallery(videos) {
      const gallery = document.getElementById('videoGallery');
      gallery.innerHTML = ''; // Clear any existing content

      const loadPromises = [
        ...videos.map((videoId, index) => addVideoToGallery(gallery, videoId, index)),
        ...videos.map((videoId, index) => addVideoToGallery(gallery, videoId, index + videos.length))
      ];

      // Wait for all iframes to load successfully
      const loadedFrames = await Promise.all(loadPromises);
      return loadedFrames.every(Boolean);
    }

    // Add each video to the gallery and return a promise that resolves when the iframe loads
    function addVideoToGallery(gallery, videoId, index) {
      return new Promise(resolve => {
        const videoContainer = document.createElement('div');
        videoContainer.classList.add('video-container');
        
        const iframe = document.createElement('iframe');
        iframe.setAttribute('id', `player-${index}`);
        iframe.src = `https://www.youtube.com/embed/${videoId}?enablejsapi=1&autoplay=1&mute=1&loop=1&playlist=${videoId}&controls=0&showinfo=0&modestbranding=1&origin=${window.location.origin}`;
        iframe.allow = "autoplay";
        iframe.width = '100%';
        iframe.height = '100%';

        // Load player when iframe loads
        iframe.onload = () => {
          const player = new YT.Player(iframe, {
            events: {
              'onReady': function (event) {
                event.target.mute(); // Start muted
              }
            }
          });

          players.push(player);
          videoContainer.addEventListener("mouseover", () => handleMouseOver(player));
          videoContainer.addEventListener("mouseleave", handleMouseLeave);

          resolve(true); // Resolve as successful once player is initialized
        };

        // Handle load failure
        iframe.onerror = () => resolve(false);

        videoContainer.appendChild(iframe);
        gallery.appendChild(videoContainer);
      });
    }

    function handleMouseOver(player) {
      if (activePlayer && activePlayer !== player) {
        activePlayer.mute(); // Mute the previously active player
      }
      player.unMute();
      activePlayer = player; // Set this player as the currently active one
    }

    function handleMouseLeave() {
      if (activePlayer) {
        activePlayer.mute();
      }
    }

    // Dynamically set the animation speed based on gallery width
    function setCarouselAnimationSpeed() {
      const gallery = document.getElementById('videoGallery');
      const galleryWidth = gallery.offsetWidth;
      const speed = galleryWidth / 50; // Adjust speed based on width
      gallery.style.animationDuration = `${speed}s`; // Set animation speed
    }

    // Initialize the carousel on page load
    initializeCarousel();
  </script>
</body>
</html>
