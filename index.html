<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Shorts Carousel</title>
  <style>
    /* Full Width and 800px Fixed Height */
    .carousel-container {
      display: flex;
      overflow: hidden;
      width: 100%;
      height: 800px;
      position: relative;
    }

    /* Wrapper for videos */
    .carousel-wrapper {
      display: flex;
      transition: transform 0.2s linear;
    }

    /* Each video container */
    .video-container {
      position: relative;
      width: calc((9 / 16) * 800px); /* Dynamic width based on 9:16 aspect ratio */
      height: 800px;
      margin-right: 4px; /* 4px margin between videos */
      flex-shrink: 0;
    }
  </style>
</head>
<body>
  <div class="carousel-container">
    <div class="carousel-wrapper" id="videoGallery"></div>
  </div>

  <!-- Load YouTube Iframe API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // Store YouTube player instances for each video
    const players = [];
    let activePlayer = null; // Track the currently active (hovered) player

    // Variables for smooth scrolling
    let scrollSpeed = 1; // Pixels per tick
    let currentScroll = 0; // Track current scroll position
    let scrollInterval;

    // Function to get URL parameters
    function getVideoParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const videos = [];
      for (const [key, value] of urlParams.entries()) {
        if (key.startsWith('video')) {
          videos.push(value);
        }
      }
      return videos;
    }

    // Initialize players once YouTube Iframe API is ready
    function onYouTubeIframeAPIReady() {
      loadVideosFromParams();
    }

    // Load videos from URL parameters and create player instances
    function loadVideosFromParams() {
      const videos = getVideoParams();
      const gallery = document.getElementById('videoGallery');

      // Clear any existing content in the gallery
      gallery.innerHTML = '';

      videos.forEach((videoId, index) => {
        const videoContainer = document.createElement('div');
        videoContainer.classList.add('video-container');
        
        // Create the iframe and set basic attributes
        const iframe = document.createElement('iframe');
        iframe.setAttribute('id', `player-${index}`);
        iframe.src = `https://www.youtube.com/embed/${videoId}?enablejsapi=1&autoplay=1&mute=1&loop=1&playlist=${videoId}&controls=0&showinfo=0&modestbranding=1`;
        iframe.allow = "autoplay";
        iframe.width = '100%';
        iframe.height = '100%';
        iframe.style.border = 'none';
        
        videoContainer.appendChild(iframe);
        gallery.appendChild(videoContainer);

        // Initialize the YouTube player for each iframe
        const player = new YT.Player(iframe, {
          events: {
            'onReady': function (event) {
              event.target.mute(); // Start muted
            }
          }
        });

        // Store player instance
        players.push(player);

        // Unmute on hover and mute on leave
        videoContainer.addEventListener("mouseover", () => handleMouseOver(player));
        videoContainer.addEventListener("mouseleave", handleMouseLeave);
      });

      // Start the smooth scrolling loop
      startScrolling(gallery);
    }

    // Function to handle mouseover (unmute only the hovered video)
    function handleMouseOver(player) {
      try {
        if (activePlayer && activePlayer !== player) {
          activePlayer.mute(); // Mute the previously active player
        }
        player.unMute();
        activePlayer = player; // Set this player as the currently active one
      } catch (error) {
        console.error("Failed to unMute player:", player, error);
      }
    }

    // Function to handle mouseleave (mute the active video)
    function handleMouseLeave() {
      try {
        if (activePlayer) {
          activePlayer.mute();
        }
      } catch (error) {
        console.error("Failed to mute player:", activePlayer, error);
      }
    }

    // Start the smooth scrolling loop
    function startScrolling(gallery) {
      const videoWidth = gallery.firstChild.offsetWidth + 4; // Width of one video + margin

      scrollInterval = setInterval(() => {
        currentScroll += scrollSpeed;

        // Apply translation to scroll the videos
        gallery.style.transform = `translateX(-${currentScroll}px)`;

        // Check if the first video is completely out of view
        const firstVideo = gallery.firstChild;
        const galleryRect = gallery.getBoundingClientRect();
        const firstVideoRect = firstVideo.getBoundingClientRect();

        if (firstVideoRect.right <= galleryRect.left) {
          // Move the first video to the end of the container
          gallery.appendChild(firstVideo);
          currentScroll -= videoWidth; // Adjust scroll to avoid a jump
          gallery.style.transform = `translateX(-${currentScroll}px)`;
        }
      }, 20); // Adjust the interval for smoother effect
    }

    // Stop scrolling when the page is not in focus
    window.addEventListener('blur', () => clearInterval(scrollInterval));
    window.addEventListener('focus', () => {
      const gallery = document.getElementById('videoGallery');
      startScrolling(gallery);
    });
  </script>
</body>
</html>
